{% extends 'admin/base_admin.html' %}
{% load static %}

{% block title %}Approve/Reject Sellers - Admin Dashboard{% endblock %}
{% block page_title %}Approve/Reject Sellers{% endblock %}

{% block admin_css %}
<link rel="stylesheet" href="{% static 'css/admin/approve_sellers.css' %}">
{% endblock %}

{% block admin_content %}
<div class="glass-card" style="padding: 25px;">
    <div class="card-header-row" style="margin-bottom: 20px;">
        <h2 class="card-title">Pending Seller Applications</h2>
    </div>

    <div class="filters-wrapper">
        <div class="search-box">
            <span class="material-icons-round search-icon" style="color: #999;">search</span>
            <input type="text" class="search-input" placeholder="Search Sellers">
        </div>
        <div class="dropdowns">
            <select class="filter-select">
                <option>Status</option>
                <option>Pending</option>
                <option>Approved</option>
                <option>Rejected</option>
            </select>
            <select class="filter-select">
                <option>Category</option>
                <option>Medical</option>
                <option>Food</option>
                <option>Supplies</option>
                <option>Equipment</option>
            </select>
        </div>
    </div>

    <div class="table-container" style="box-shadow: none; padding: 0; background: transparent;">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Seller ID</th>
                    <th>Business Name</th>
                    <th>Owner</th>
                    <th>Category</th>
                    <th>Registration Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for seller_profile in sellers %}
                <tr>
                    <td>SEL-{{ seller_profile.id|stringformat:"03d" }}</td>
                    <td>{{ seller_profile.user.username }}</td>
                    <td>{{ seller_profile.user.get_full_name }}</td>
                    <td>General</td>
                    <td>{{ seller_profile.user.date_joined|date:"Y-m-d" }}</td>
                    <td>
                        {% if seller_profile.user.is_active %}
                        <span class="badge badge-approved">Approved</span>
                        {% else %}
                        <span class="badge badge-pending">Pending</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if not seller_profile.user.is_active %}
                        <button class="btn-approve">Approve</button>
                        <button class="btn-reject">Reject</button>
                        {% else %}
                        <button class="btn-action">View Details</button>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 30px; color: #888;">No sellers found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block admin_js %}
<script>
    // View Details functionality for sellers
    document.querySelectorAll('.btn-action, .btn-approve, .btn-reject').forEach(btn => {
        // Only attach generic listener to action buttons, specific logic might be needed for approve/reject
        if (btn.classList.contains('btn-action')) {
            btn.addEventListener('click', function () {
                const row = this.closest('tr');
                const cells = row.getElementsByTagName('td');
                const sellerId = cells[0].textContent;
                const sellerName = cells[1].textContent; // Business Name (mapping 1)
                const sellerOwner = cells[2].textContent; // Owner (mapping 2)
                // Wait: Table Header: ID=0, Business=1, Owner=2, Category=3...

                const sellerStatus = row.querySelector('.badge') ? row.querySelector('.badge').textContent : 'Active';

                // Create seller details modal
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">Seller Details</h2>
                            <button class="modal-close" onclick="closeViewModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="seller-detail-card">
                                <div class="detail-header" style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px;">
                                    <div class="detail-avatar" style="width: 50px; height: 50px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <span class="material-icons-round" style="font-size: 30px; color: #555;">storefront</span>
                                    </div>
                                    <div class="detail-info">
                                        <h3 style="margin: 0;">${sellerName}</h3>
                                        <p style="margin: 0; color: #666;">ID: ${sellerId}</p>
                                        <div class="detail-badges" style="margin-top: 5px;">
                                            <span class="badge badge-approved">${sellerStatus}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="detail-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div class="detail-item">
                                        <label style="font-weight: 600; font-size: 0.9rem;">Owner Name</label>
                                        <p style="margin: 5px 0;">${sellerOwner}</p>
                                    </div>
                                    <div class="detail-item">
                                        <label style="font-weight: 600; font-size: 0.9rem;">Category</label>
                                        <p style="margin: 5px 0;">General</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" style="padding: 8px 15px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;" onclick="closeViewModal()">Close</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                document.body.style.overflow = 'hidden';
            });
        }

        // Approve Button Logic (Simulation)
        if (btn.classList.contains('btn-approve')) {
            btn.addEventListener('click', function () {
                alert('Seller Approved (Simulated)');
                location.reload();
            });
        }

        // Reject Button Logic (Simulation)
        if (btn.classList.contains('btn-reject')) {
            btn.addEventListener('click', function () {
                alert('Seller Rejected (Simulated)');
                location.reload();
            });
        }
    });

    // Modal close function
    window.closeViewModal = function () {
        const modal = document.querySelector('.modal');
        if (modal) {
            document.body.removeChild(modal);
            document.body.style.overflow = 'auto';
        }
    };
</script>
{% endblock %}