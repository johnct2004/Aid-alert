{% extends 'admin/base_admin.html' %}
{% load static %}

{% block title %}Manage Facilities - Admin Dashboard{% endblock %}
{% block page_title %}Manage Facilities{% endblock %}

{% block admin_css %}
<link rel="stylesheet" href="{% static 'css/admin/manage_facilities.css' %}">
{% endblock %}

{% block admin_content %}
<div class="glass-card">
    <div class="card-header-row">
        <h2 class="card-title">All Facilities</h2>
    </div>

    <div class="filters-wrapper">
        <div class="search-box">
            <span class="material-icons-round search-icon" style="color: #999;">search</span>
            <input type="text" class="search-input" placeholder="Search Facilities">
        </div>
        <div class="dropdowns">
            <select class="filter-select">
                <option>Type</option>
                <option>Medical</option>
                <option>Shelter</option>
                <option>Logistics</option>
            </select>
            <select class="filter-select">
                <option>Status</option>
                <option>Active</option>
                <option>Inactive</option>
                <option>Full</option>
            </select>
        </div>
    </div>

    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Facility ID</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Location</th>
                    <th>Capacity</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for facility in facilities %}
                <tr>
                    <td>FAC-{{ facility.id|stringformat:"03d" }}</td>
                    <td style="font-weight: 500;">
                        {% if facility.real_facility %}
                        {{ facility.real_facility.facility_name }}
                        {% else %}
                        {{ facility.user.get_full_name|default:facility.user.username }}
                        {% endif %}
                    </td>
                    <td>{{ facility.role|title }}</td>
                    <td>
                        {% if facility.real_facility %}
                        {{ facility.real_facility.address }}
                        {% else %}
                        {{ facility.address }}
                        {% endif %}
                    </td>
                    <td>
                        {% if facility.real_facility %}
                        {{ facility.real_facility.capacity }}
                        {% else %}
                        â€”
                        {% endif %}
                    </td>
                    <td>
                        {% if facility.real_facility %}
                        <span class="badge badge-{{ facility.real_facility.status }}">
                            {{ facility.real_facility.get_status_display }}
                        </span>
                        {% else %}
                        {% if facility.user.is_active %}
                        <span class="badge badge-active">Active</span>
                        {% else %}
                        <span class="badge badge-inactive">Inactive</span>
                        {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <!-- View Button (using new openViewModal) -->
                            <button class="btn-icon view-btn" onclick="openViewModal(this)"
                                data-id="FAC-{{ facility.id|stringformat:'03d' }}"
                                data-name="{% if facility.real_facility %}{{ facility.real_facility.facility_name }}{% else %}{{ facility.user.get_full_name|default:facility.user.username }}{% endif %}"
                                data-type="Facility"
                                data-address="{% if facility.real_facility %}{{ facility.real_facility.address }}{% else %}{{ facility.address }}{% endif %}"
                                data-status="{% if facility.real_facility %}{{ facility.real_facility.get_status_display }}{% else %}{% if facility.user.is_active %}Active{% else %}Inactive{% endif %}{% endif %}"
                                style="background:none; border:none; color:var(--primary-color); cursor:pointer;">
                                <span class="material-icons-round">visibility</span>
                            </button>

                            <!-- Edit Button -->
                            <button class="btn-icon edit-btn" onclick="openEditModal(this)"
                                data-profile-id="{{ facility.id }}" data-id="FAC-{{ facility.id|stringformat:'03d' }}"
                                data-name="{% if facility.real_facility %}{{ facility.real_facility.facility_name }}{% else %}{{ facility.user.get_full_name|default:facility.user.username }}{% endif %}"
                                data-address="{% if facility.real_facility %}{{ facility.real_facility.address }}{% else %}{{ facility.address }}{% endif %}"
                                data-capacity="{% if facility.real_facility %}{{ facility.real_facility.capacity }}{% else %}0{% endif %}"
                                data-status="{% if facility.real_facility %}{{ facility.real_facility.status }}{% else %}{% if facility.user.is_active %}active{% else %}inactive{% endif %}{% endif %}"
                                style="background:none; border:none; color:var(--warning-color); cursor:pointer;">
                                <span class="material-icons-round">edit</span>
                            </button>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 30px; color: #888;">No facilities found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block admin_js %}
<script src="{% static 'js/admin/manage_facilities.js' %}"></script>
{% endblock %}