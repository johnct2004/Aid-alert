{% extends 'facility manager/base_facility.html' %}
{% load static %}

{% block page_title %}Facility Profile{% endblock %}
{% block content_title %}Facility Profile{% endblock %}

{% block facility_css %}
<link rel="stylesheet" href="{% static 'css/facility manager/facility_profile.css' %}">
{% endblock %}

{% block facility_content %}

<!-- Profile Overview -->
<div class="glass-card profile-section-card">
    <div class="card-header-row">
        <h2 class="card-title">Profile Overview</h2>

    </div>

    <div class="profile-overview">
        <div class="profile-avatar">
            <div class="avatar-large">
                <span class="material-icons-round">business</span>
            </div>
        </div>

        <div class="profile-info">
            <div class="info-grid">

                <div class="info-item">
                    <h3 class="info-label">Facility Name</h3>
                    <p class="info-value" id="overview-name">{{ user.get_full_name|default:user.username }}</p>
                    <input type="text" class="info-input hidden" id="overview-name-input"
                        value="{{ user.get_full_name|default:user.username }}">
                </div>
                <div class="info-item">
                    <h3 class="info-label">Email</h3>
                    <p class="info-value" id="overview-email">{{ user.email }}</p>
                    <input type="email" class="info-input hidden" id="overview-email-input" value="{{ user.email }}">
                </div>

                <div class="info-item">
                    <h3 class="info-label">Status</h3>
                    <p class="info-value" id="overview-status">Active</p>
                    <select class="info-input hidden" id="overview-status-input">
                        <option value="Active" selected>Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Suspended">Suspended</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Facility Information -->
<div class="glass-card profile-section-card">
    <form method="POST" style="width: 100%;">
        {% csrf_token %}
        <div class="card-header-row">
            <h2 class="card-title">Facility Information</h2>
            <div class="profile-actions facility-actions">
                <button type="button" class="btn-secondary edit-facility-btn" onclick="toggleFacilityEdit(this)">
                    <span class="material-icons-round">edit</span> Edit
                </button>
                <button type="submit" class="btn-primary save-facility-btn hidden">
                    <span class="material-icons-round">save</span> Save
                </button>
                <button type="button" class="btn-secondary cancel-facility-btn hidden"
                    onclick="cancelFacilityEdit(this)">
                    <span class="material-icons-round">close</span> Cancel
                </button>
            </div>
        </div>

        <div class="facility-info facility-info-layout">
            <div class="info-section">
                <h3 class="section-title">Basic Details</h3>
                <div class="info-grid single-column">


                    <div class="info-item">
                        <h4 class="info-label">Facility Name</h4>
                        <p class="info-value">{{ user.facility_profile.facility_name|default:user.get_full_name }}</p>
                        <p class="info-input hidden text-muted">Cannot be edited directly</p>
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Registration Date</h4>
                        <p class="info-value" id="registration-date">{{ user.date_joined|date:"M d, Y" }}</p>
                        <p class="info-input hidden text-muted">Cannot be edited</p>
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Capacity</h4>
                        <p class="info-value" id="capacity">{{ user.facility_profile.capacity|default:"0" }} beds</p>
                        <input type="text" class="info-input hidden" id="capacity-input" name="capacity"
                            value="{{ user.facility_profile.capacity|default:'0' }}">
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3 class="section-title">Contact Information</h3>
                <div class="info-grid single-column">
                    <div class="info-item">
                        <h4 class="info-label">Official Email</h4>
                        <p class="info-value" id="official-email">{{ user.email }}</p>
                        <input type="email" class="info-input hidden" id="official-email-input"
                            value="{{ user.email }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Phone Number</h4>
                        <p class="info-value" id="phone-number">{{ user.profile.phone|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="phone-number-input" name="phone"
                            value="{{ user.profile.phone|default:'' }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Address</h4>
                        <p class="info-value" id="address">{{ user.facility_profile.address|default:"Not Provided" }}
                        </p>
                        <input type="text" class="info-input hidden" id="address-input" name="address"
                            value="{{ user.facility_profile.address|default:'' }}">
                    </div>
                </div>
            </div>
        </div>
</div>
</form>
</div>

<!-- System Access & Actions Grid -->
<div class="facility-info-layout">
    <!-- Facility Settings -->
    <div class="glass-card profile-action-card">
        <div class="card-header-row">
            <h2 class="card-title">Facility Settings</h2>
        </div>
        <div class="settings-list">
            <div class="setting-item">
                <div class="setting-info">
                    <h4 class="setting-title">Emergency Notifications</h4>
                    <p class="setting-description">Receive alerts for critical incidents</p>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h4 class="setting-title">Auto-Assignment</h4>
                    <p class="setting-description">Automatically assign nearby responders</p>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h4 class="setting-title">Stock Alerts</h4>
                    <p class="setting-description">Low inventory notifications</p>
                </div>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h4 class="setting-title" style="color: #dc3545;">Delete Account</h4>
                    <p class="setting-description">Permanently remove your account</p>
                </div>
                <button class="btn-secondary" style="color: #dc3545; border-color: #dc3545;"
                    onclick="showDeleteModal()">
                    <span class="material-icons-round">delete_forever</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="glass-card profile-action-card">
        <div class="card-header-row">
            <h2 class="card-title">Quick Actions</h2>
        </div>
        <div class="action-buttons">
            <a href="{% url 'aid_app:manage_kits' %}" class="action-btn">
                <span class="material-icons-round">inventory_2</span>
                <span>Manage First Aid Kits</span>
            </a>
            <a href="{% url 'aid_app:assign_responders' %}" class="action-btn">
                <span class="material-icons-round">person_add</span>
                <span>Assign Responders</span>
            </a>
            <a href="{% url 'aid_app:facility_reports' %}" class="action-btn">
                <span class="material-icons-round">analytics</span>
                <span>View Reports</span>
            </a>
            <a href="{% url 'aid_app:facility_incident_log' %}" class="action-btn">
                <span class="material-icons-round">article</span>
                <span>Incident Log</span>
            </a>
        </div>
    </div>
</div>
</div>

<!-- Delete Account Modal -->
<div id="delete-account-modal" class="modal-overlay hidden">
    <div class="glass-card modal-box">
        <h3 class="modal-title" style="color: #dc3545;">Delete Account</h3>
        <p class="modal-text" style="color: #333; margin: 20px 0;">Do you want to delete account?</p>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="hideDeleteModal()">No</button>
            <form action="{% url 'aid_app:delete_facility_account' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn-primary"
                    style="background-color: #dc3545; border-color: #dc3545;">Yes</button>
            </form>
        </div>
    </div>
</div>


{% endblock %}

{% block facility_js %}
<script>
    function toggleFacilityEdit(button) {
        const card = button.closest('.profile-section-card');
        const inputs = card.querySelectorAll('.info-input');
        const values = card.querySelectorAll('.info-value');
        const saveBtn = card.querySelector('.save-facility-btn');
        const cancelBtn = card.querySelector('.cancel-facility-btn');
        const editBtns = card.querySelectorAll('.edit-facility-btn');

        // Show inputs, hide values
        inputs.forEach(input => input.classList.remove('hidden'));
        values.forEach(value => value.classList.add('hidden'));

        // Show save/cancel, hide edit buttons
        saveBtn.classList.remove('hidden');
        cancelBtn.classList.remove('hidden');
        editBtns.forEach(btn => btn.classList.add('hidden'));
    }

    function cancelFacilityEdit(button) {
        const card = button.closest('.profile-section-card');
        const inputs = card.querySelectorAll('.info-input');
        const values = card.querySelectorAll('.info-value');
        const saveBtn = card.querySelector('.save-facility-btn');
        const cancelBtn = card.querySelector('.cancel-facility-btn');
        const editBtns = card.querySelectorAll('.edit-facility-btn');

        // Hide inputs, show values
        inputs.forEach(input => input.classList.add('hidden'));
        values.forEach(value => value.classList.remove('hidden'));

        // Hide save/cancel, show edit buttons
        saveBtn.classList.add('hidden');
        cancelBtn.classList.add('hidden');
        editBtns.forEach(btn => btn.classList.remove('hidden'));
    }

    function saveFacilityInfo(button) {
        // Add save logic here
        cancelFacilityEdit(button);
    }
    function showDeleteModal() {
        document.getElementById('delete-account-modal').classList.remove('hidden');
    }

    function hideDeleteModal() {
        document.getElementById('delete-account-modal').classList.add('hidden');
    }
</script>
{% endblock %}