{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facility Profile - Aid Alert</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/facility manager/facility_dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/facility manager/facility_profile.css' %}">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar (Standard) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="brand">
                    <span class="material-icons-round brand-icon">health_and_safety</span>
                    <span class="brand-text">Aid Alert</span>
                </a>
            </div>

            <ul class="menu">
                <li class="menu-item">
                    <a href="{% url 'aid_app:facility_dashboard' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">dashboard</span>
                        <span>Home</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="{% url 'aid_app:manage_kits' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">inventory_2</span>
                        <span>Manage Kits</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="{% url 'aid_app:stock_tracking' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">show_chart</span>
                        <span>Stock Tracking</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="{% url 'aid_app:assign_responders' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">person_add</span>
                        <span>Assign Responders</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="{% url 'aid_app:facility_incident_log' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">article</span>
                        <span>Facility Incident Log</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="{% url 'aid_app:facility_reports' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">analytics</span>
                        <span>Facility Reports</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="{% url 'aid_app:facility_notifications' %}" class="menu-link">
                        <span class="material-icons-round menu-icon">notifications</span>
                        <span>Facility Notifications</span>
                    </a>
                </li>

                <li class="menu-item mt-auto">
                    <a href="{% url 'aid_app:logout' %}" class="menu-link logout-link">
                        <span class="material-icons-round menu-icon">logout</span>
                        <span>Log Out</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title">Facility Profile</h1>
                <a href="{% url 'aid_app:facility_profile' %}" class="user-profile">
                    <span class="user-name">{{ user.username|default:"Facility Manager" }}</span>
                    <div class="avatar-circle">
                        <span class="material-icons-round">person</span>
                    </div>
                </a>
            </header>

            <div class="content-wrapper">

                <!-- Profile Overview -->
                <section class="glass-card profile-section-card">
                    <div class="card-header-row">
                        <h2 class="card-title">Profile Overview</h2>
                        <div class="profile-actions">
                            <button class="btn-secondary edit-profile-btn" onclick="toggleProfileEdit(this)">
                                <span class="material-icons-round">edit</span> Edit
                            </button>
                            <button class="btn-primary save-profile-btn hidden" onclick="saveProfileInfo(this)">
                                <span class="material-icons-round">save</span> Save
                            </button>
                            <button class="btn-secondary cancel-profile-btn hidden" onclick="cancelProfileEdit(this)">
                                <span class="material-icons-round">close</span> Cancel
                            </button>
                        </div>
                    </div>

                    <div class="profile-overview">
                        <div class="profile-avatar">
                            <div class="avatar-large">
                                <span class="material-icons-round">business</span>
                            </div>
                        </div>
                        <div class="profile-info">
                            <div class="info-grid single-column">
                                <div class="info-item">
                                    <h3 class="info-label">Facility Name</h3>
                                    <p class="info-value text-large">{{ user.profile.facility_name|default:"Main
                                        Facility" }}</p>
                                    <input type="text" class="info-input hidden"
                                        value="{{ user.profile.facility_name|default:'Main Facility' }}">
                                </div>
                                <div class="info-item">
                                    <h3 class="info-label">Facility Type</h3>
                                    <p class="info-value">{{ user.profile.facility_type|default:"Medical Facility" }}
                                    </p>
                                    <input type="text" class="info-input hidden"
                                        value="{{ user.profile.facility_type|default:'Medical Facility' }}">
                                </div>
                                <div class="info-item no-border-padding">
                                    <div class="profile-badges">
                                        <span class="status-badge active">Active</span>
                                        <span class="status-badge available">Verified</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 2-Column Layout for Details -->
                <div class="admin-info-layout">
                    <!-- Basic Information -->
                    <section class="glass-card profile-section-card mb-0">
                        <div class="card-header-row">
                            <h2 class="card-title">Basic Information</h2>
                            <div class="profile-actions">
                                <button class="btn-secondary edit-profile-btn" onclick="toggleProfileEdit(this)">
                                    <span class="material-icons-round">edit</span>
                                </button>
                                <button class="btn-primary save-profile-btn hidden" onclick="saveProfileInfo(this)">
                                    <span class="material-icons-round">save</span>
                                </button>
                                <button class="btn-secondary cancel-profile-btn hidden"
                                    onclick="cancelProfileEdit(this)">
                                    <span class="material-icons-round">close</span>
                                </button>
                            </div>
                        </div>
                        <div class="info-grid single-column">
                            <div class="info-item">
                                <h3 class="info-label">License Number</h3>
                                <p class="info-value">{{ user.profile.license_number|default:"MED-2024-001" }}</p>
                                <input type="text" class="info-input hidden"
                                    value="{{ user.profile.license_number|default:'MED-2024-001' }}">
                            </div>
                            <div class="info-item">
                                <h3 class="info-label">Registration Date</h3>
                                <p class="info-value">{{ user.date_joined|date:"M d, Y" }}</p>
                                <p class="info-input hidden text-muted">Cannot be edited</p>
                            </div>
                        </div>
                    </section>

                    <!-- Contact Information -->
                    <section class="glass-card profile-section-card mb-0">
                        <div class="card-header-row">
                            <h2 class="card-title">Contact Information</h2>
                            <div class="profile-actions">
                                <button class="btn-secondary edit-profile-btn" onclick="toggleProfileEdit(this)">
                                    <span class="material-icons-round">edit</span>
                                </button>
                                <button class="btn-primary save-profile-btn hidden" onclick="saveProfileInfo(this)">
                                    <span class="material-icons-round">save</span>
                                </button>
                                <button class="btn-secondary cancel-profile-btn hidden"
                                    onclick="cancelProfileEdit(this)">
                                    <span class="material-icons-round">close</span>
                                </button>
                            </div>
                        </div>
                        <div class="info-grid single-column">
                            <div class="info-item">
                                <h3 class="info-label">Email</h3>
                                <p class="info-value">{{ user.email|default:"facility@example.com" }}</p>
                                <input type="email" class="info-input hidden" value="{{ user.email }}">
                            </div>
                            <div class="info-item">
                                <h3 class="info-label">Phone</h3>
                                <p class="info-value">{{ user.profile.phone|default:"+1 (555) 123-4567" }}</p>
                                <input type="tel" class="info-input hidden"
                                    value="{{ user.profile.phone|default:'+1 (555) 123-4567' }}">
                            </div>
                            <div class="info-item">
                                <h3 class="info-label">Address</h3>
                                <p class="info-value">{{ user.profile.address|default:"123 Medical Center Drive" }}</p>
                                <input type="text" class="info-input hidden"
                                    value="{{ user.profile.address|default:'123 Medical Center Drive' }}">
                            </div>
                            <div class="info-item">
                                <h3 class="info-label">Website</h3>
                                <p class="info-value">{{ user.profile.website|default:"www.facility-website.com" }}</p>
                                <input type="text" class="info-input hidden"
                                    value="{{ user.profile.website|default:'www.facility-website.com' }}">
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Operational Information (Full Width) -->
                <section class="glass-card profile-section-card">
                    <div class="card-header-row">
                        <h2 class="card-title">Operational Information</h2>
                        <div class="profile-actions">
                            <button class="btn-secondary edit-profile-btn" onclick="toggleProfileEdit(this)">
                                <span class="material-icons-round">edit</span> Edit
                            </button>
                            <button class="btn-primary save-profile-btn hidden" onclick="saveProfileInfo(this)">
                                <span class="material-icons-round">save</span> Save
                            </button>
                            <button class="btn-secondary cancel-profile-btn hidden" onclick="cancelProfileEdit(this)">
                                <span class="material-icons-round">close</span> Cancel
                            </button>
                        </div>
                    </div>
                    <div class="info-grid grid-tight">
                        <div class="info-item">
                            <h3 class="info-label">Operating Hours</h3>
                            <p class="info-value">{{ user.profile.operating_hours|default:"24/7" }}</p>
                            <input type="text" class="info-input hidden"
                                value="{{ user.profile.operating_hours|default:'24/7' }}">
                        </div>
                        <div class="info-item">
                            <h3 class="info-label">Emergency Services</h3>
                            <p class="info-value">{{ user.profile.emergency_services|default:"Available" }}</p>
                            <select class="info-input hidden">
                                <option value="Available" selected>Available</option>
                                <option value="Limited">Limited</option>
                                <option value="Unavailable">Unavailable</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <h3 class="info-label">Bed Capacity</h3>
                            <p class="info-value">{{ user.profile.bed_capacity|default:"150" }}</p>
                            <input type="number" class="info-input hidden"
                                value="{{ user.profile.bed_capacity|default:'150' }}">
                        </div>
                        <div class="info-item">
                            <h3 class="info-label">Staff Count</h3>
                            <p class="info-value">{{ user.profile.staff_count|default:"250" }}</p>
                            <input type="number" class="info-input hidden"
                                value="{{ user.profile.staff_count|default:'250' }}">
                        </div>
                    </div>
                </section>

                <!-- Quick Actions -->
                <section class="glass-card profile-action-card">
                    <h2 class="card-title mb-20">Quick Actions</h2>
                    <div class="account-actions-grid">
                        <a href="{% url 'aid_app:facility_dashboard' %}" class="action-btn">
                            <span class="material-icons-round">dashboard</span>
                            <span>Dashboard</span>
                        </a>
                        <a href="{% url 'aid_app:facility_incident_log' %}" class="action-btn">
                            <span class="material-icons-round">article</span>
                            <span>Incident Log</span>
                        </a>
                        <a href="{% url 'aid_app:manage_kits' %}" class="action-btn">
                            <span class="material-icons-round">inventory_2</span>
                            <span>Manage Kits</span>
                        </a>
                        <a href="{% url 'aid_app:contact' %}" class="action-btn">
                            <span class="material-icons-round">support_agent</span>
                            <span>Support</span>
                        </a>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- Joint JS Logic -->
    <script>
        // Scoped functions to handle section-specific editing
        function toggleProfileEdit(btn) {
            const container = btn.closest('.glass-card');
            if (!container) return;

            container.querySelectorAll('.info-value').forEach(el => el.classList.add('hidden'));
            container.querySelectorAll('.info-input').forEach(el => el.classList.remove('hidden'));

            container.querySelectorAll('.edit-profile-btn').forEach(b => b.classList.add('hidden'));
            container.querySelectorAll('.save-profile-btn').forEach(b => b.classList.remove('hidden'));
            container.querySelectorAll('.cancel-profile-btn').forEach(b => b.classList.remove('hidden'));
        }

        function cancelProfileEdit(btn) {
            const container = btn.closest('.glass-card');
            if (!container) return;

            container.querySelectorAll('.info-input').forEach(el => el.classList.add('hidden'));
            container.querySelectorAll('.info-value').forEach(el => el.classList.remove('hidden'));

            container.querySelectorAll('.edit-profile-btn').forEach(b => b.classList.remove('hidden'));
            container.querySelectorAll('.save-profile-btn').forEach(b => b.classList.add('hidden'));
            container.querySelectorAll('.cancel-profile-btn').forEach(b => b.classList.add('hidden'));
        }

        function saveProfileInfo(btn) {
            const container = btn.closest('.glass-card');
            if (!container) return;

            const inputs = container.querySelectorAll('.info-input');
            const values = container.querySelectorAll('.info-value');

            // Simple UI update simulation
            inputs.forEach((input, index) => {
                if (values[index]) {
                    if (input.tagName === 'SELECT') {
                        values[index].textContent = input.value;
                    } else if (input.value) {
                        values[index].textContent = input.value;
                    }
                }
            });

            cancelProfileEdit(btn);
            showNotification('Changes saved successfully!');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'glass-alert';
            notification.innerHTML = `<span class="material-icons-round">check_circle</span> <span>${message}</span>`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-color);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 500;
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 10px;
                animation: slideIn 0.3s ease-out;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                backdrop-filter: blur(10px);
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Add minimal animation keyframes
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>