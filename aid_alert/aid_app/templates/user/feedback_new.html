{% extends 'user/base_user.html' %}
{% load static %}

{% block page_title %}Give Feedback{% endblock %}

{% block user_css %}
<link rel="stylesheet" href="{% static 'css/user/give_feedback.css' %}">
{% endblock %}

{% block user_content %}
<div class="feedback-container">
    <div class="glass-card form-card">
        <div class="card-header">
            <h2 class="card-title">Share Your Experience</h2>
            {% if incident %}
            <div class="incident-context"
                style="margin-top: 10px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 8px; border-left: 4px solid var(--primary-color);">
                <p class="card-subtitle" style="margin:0; color: var(--text-color); font-weight: 500;">
                    Feedback for Incident #{{ incident.incident_id }}
                </p>
                <small style="color: #666;">
                    {{ incident.get_incident_type_display }} - {{ incident.created_at|date:"M d, Y" }}
                    <br>
                    <strong>Responder:</strong> {{
                    incident.assigned_responder.user.get_full_name|default:incident.assigned_responder.user.username|default:"Unassigned"
                    }}
                </small>
            </div>
            {% else %}
            <p class="card-subtitle">We value your feedback to improve our services.</p>
            {% endif %}
        </div>

        <form class="feedback-form" action="{% url 'aid_app:give_feedback' %}" method="POST">
            {% csrf_token %}
            {% if incident %}
            <input type="hidden" name="incident_id" value="{{ incident.id }}">
            {% endif %}
            <!-- Personal Information -->
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" class="form-input"
                        value="{{ user.first_name|default:user.username }}" readonly>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" class="form-input" value="{{ user.email }}" readonly>
                </div>
            </div>

            <!-- Feedback Type -->
            <div class="form-group">
                <label>Feedback Type</label>
                <div class="rating-options">
                    <label class="radio-label">
                        <input type="radio" name="feedbackType" value="Complaint" required>
                        <span class="radio-btn">Complaint</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="feedbackType" value="Suggestion">
                        <span class="radio-btn">Suggestion</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="feedbackType" value="Compliment">
                        <span class="radio-btn">Compliment</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="feedbackType" value="General" checked>
                        <span class="radio-btn">General</span>
                    </label>
                </div>
            </div>

            <!-- Service Rating -->
            <div class="form-group">
                <label>Rate Our Service</label>
                <div class="rating-options">
                    <label class="radio-label">
                        <input type="radio" name="rating" value="5" required>
                        <span class="radio-btn">Excellent</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="rating" value="4">
                        <span class="radio-btn">Good</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="rating" value="3">
                        <span class="radio-btn">Average</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="rating" value="2">
                        <span class="radio-btn">Poor</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="rating" value="1">
                        <span class="radio-btn">Very Poor</span>
                    </label>
                </div>
            </div>

            <!-- Message -->
            <div class="form-group">
                <label for="message">Your Feedback</label>
                <textarea id="message" name="message" class="form-input form-textarea"
                    placeholder="Please share your detailed feedback here..." rows="6" required></textarea>
            </div>

            <!-- Submit -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-submit">
                    <span class="material-icons-round">send</span>
                    Submit Feedback
                </button>
            </div>
        </form>

        <div class="history-link-wrapper">
            <a href="{% url 'aid_app:my_feedback' %}" class="btn btn-secondary history-link">
                View My Past Feedback
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block user_js %}
<script src="{% static 'js/user/feedback.js' %}"></script>
{% endblock %}