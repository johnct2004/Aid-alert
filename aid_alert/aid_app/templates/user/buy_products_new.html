{% extends 'user/base_user.html' %}
{% load static %}

{% block page_title %}Emergency Products{% endblock %}

{% block user_css %}
<link rel="stylesheet" href="{% static 'css/user/buy_products_new.css' %}">
{% endblock %}

{% block user_content %}
<div class="products-container">
    <!-- Categories -->
    <div class="glass-card categories-wrapper">
        <div class="categories">
            <button class="category-btn active" onclick="filterCategory('all')">
                <span class="material-icons-round">grid_view</span>
                All
            </button>
            <button class="category-btn" onclick="filterCategory('first-aid')">
                <span class="material-icons-round">medical_services</span>
                First Aid
            </button>
            <button class="category-btn" onclick="filterCategory('emergency')">
                <span class="material-icons-round">emergency</span>
                Emergency
            </button>
            <button class="category-btn" onclick="filterCategory('safety')">
                <span class="material-icons-round">health_and_safety</span>
                Safety
            </button>
            <button class="category-btn" onclick="filterCategory('medical')">
                <span class="material-icons-round">healing</span>
                Medical
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content-area">
        <!-- Products Grid -->
        <div class="products-grid" id="productsGrid">
            {% if products %}
                <!-- Populated by JS -->
            {% else %}
                <div class="no-products-message">
                    <span class="material-icons-round" style="font-size: 48px; color: #999;">inventory_2</span>
                    <h3>No Products Available</h3>
                    <p>There are currently no products available for purchase. Please check back later.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Floating Cart Summary -->
    <div class="cart-summary-floating">
        <div class="cart-summary-content" onclick="openCart()">
            <div class="cart-icon-wrapper">
                <span class="material-icons-round">shopping_cart</span>
                <span class="cart-badge-count">0</span>
            </div>
            <div class="cart-text-details">
                <span class="cart-total-label">Total</span>
                <span class="cart-total-value">$0.00</span>
            </div>
        </div>
    </div>
</div>

<!-- Shopping Cart Modal -->
<div class="modal-backdrop" id="cartModal">
    <div class="glass-card modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Shopping Cart</h2>
            <button class="modal-close" onclick="closeCart()">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="cart-items" id="cartItems">
                <!-- Cart items will be populated by JavaScript -->
            </div>
            <div class="cart-summary-modal">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="cartSubtotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Tax (10%):</span>
                    <span id="cartTax">$0.00</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span id="cartTotal">$0.00</span>
                </div>
            </div>
            <div class="cart-actions">
                <button class="btn btn-secondary" onclick="clearCart()">Clear Cart</button>
                <button class="btn btn-primary" onclick="checkout()">Proceed to Checkout</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block user_js %}
<script src="{% static 'js/user/buy_products.js' %}"></script>
<script>
    // Check if there are any products
    {% if products %}
    const productsData = [
        {% for product in products %}
    {
        id: '{{ product.id }}',
        name: '{{ product.name|escapejs }}',
        category: '{{ product.category }}',
        price: {{ product.price|default:0 }},
        image: '{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/200x150?text=No+Image{% endif %}',
        description: '{{ product.description|escapejs|linebreaksbr }}',
        inStock: {{ product.stock_quantity }} > 0,
        stock: {{ product.stock_quantity }},
        rating: 4.5,
        reviews: 12
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
    ];
    {% else %}
    const productsData = [];
    {% endif %}

    // Pass Django URL to JS
    window.checkoutUrl = '{% url "aid_app:checkout" %}';

    document.addEventListener('DOMContentLoaded', function () {
        initBuyProducts(productsData);
    });
</script>
{% endblock %}