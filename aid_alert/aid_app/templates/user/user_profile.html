{% extends 'user/base_user.html' %}
{% load static %}

{% block page_title %}User Profile{% endblock %}

{% block user_css %}
<link rel="stylesheet" href="{% static 'css/user/user_profile.css' %}">
{% endblock %}

{% block user_content %}
<div class="profile-container">
    <!-- Profile Overview -->
    <div class="glass-card content-card">
        <div class="card-header-row">
            <h2 class="card-title">Profile Overview</h2>
            <div class="profile-actions">

            </div>
        </div>

        <div class="profile-overview">
            <div class="profile-avatar">
                <div class="avatar-large">
                    <span class="material-icons-round">person</span>
                </div>
            </div>

            <div class="profile-info">
                <div class="info-grid">
                    <div class="info-item">
                        <h3 class="info-label">Full Name</h3>
                        <p class="info-value">{{ user.first_name }} {{ user.last_name }}</p>
                    </div>
                    <div class="info-item">
                        <h3 class="info-label">Email</h3>
                        <p class="info-value">{{ user.email }}</p>
                    </div>
                    <div class="info-item">
                        <h3 class="info-label">Phone</h3>
                        <p class="info-value">{{ user.profile.phone|default:"Not Provided" }}</p>
                    </div>
                    <div class="info-item">
                        <h3 class="info-label">User ID</h3>
                        <p class="info-value">USR-{{ user.id|stringformat:"06d" }}</p>
                    </div>
                    <div class="info-item">
                        <h3 class="info-label">Member Since</h3>
                        <p class="info-value">{{ user.date_joined|date:"F d, Y" }}</p>
                    </div>
                    <div class="info-item">
                        <h3 class="info-label">Account Type</h3>
                        <p class="info-value">Standard User</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Personal Information -->
    <div class="glass-card content-card">
        <div class="card-header-row">
            <h2 class="card-title">Personal Information</h2>
            <div class="personal-actions">
                <button class="btn btn-secondary edit-personal-btn">
                    <span class="material-icons-round">edit</span>
                    Edit Personal Info
                </button>
                <button class="btn btn-primary save-personal-btn hidden">
                    <span class="material-icons-round">save</span>
                    Save Changes
                </button>
                <button class="btn btn-secondary cancel-personal-btn hidden">
                    <span class="material-icons-round">close</span>
                    Cancel
                </button>
            </div>
        </div>

        <div class="personal-info">
            <div class="info-section">
                <h3 class="section-title">Contact Details</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <h4 class="info-label">First Name</h4>
                        <p class="info-value" id="first-name">{{ user.first_name }}</p>
                        <input type="text" class="info-input hidden" id="first-name-input"
                            value="{{ user.first_name }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Last Name</h4>
                        <p class="info-value" id="last-name">{{ user.last_name }}</p>
                        <input type="text" class="info-input hidden" id="last-name-input" value="{{ user.last_name }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Email Address</h4>
                        <p class="info-value" id="email">{{ user.email }}</p>
                        <input type="email" class="info-input hidden" id="email-input" value="{{ user.email }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Phone Number</h4>
                        <p class="info-value" id="phone">{{ user.profile.phone|default:"Not Provided" }}</p>
                        <input type="tel" class="info-input hidden" id="phone-input"
                            value="{{ user.profile.phone|default:'' }}">
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3 class="section-title">Address Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <h4 class="info-label">Home Address</h4>
                        <p class="info-value" id="home-address">{{ user.profile.address|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="home-address-input"
                            value="{{ user.profile.address|default:'' }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">City</h4>
                        <p class="info-value" id="city">{{ user.profile.city|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="city-input"
                            value="{{ user.profile.city|default:"" }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">State/Province</h4>
                        <p class="info-value" id="state">{{ user.profile.state|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="state-input"
                            value="{{ user.profile.state|default:"" }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Postal Code</h4>
                        <p class="info-value" id="postal-code">{{ user.profile.postal_code|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="postal-code-input"
                            value="{{ user.profile.postal_code|default:'' }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Country</h4>
                        <p class="info-value" id="country">{{ user.profile.country|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="country-input"
                            value="{{ user.profile.country|default:"" }}">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Information -->
    <div class="glass-card content-card">
        <div class="card-header-row">
            <h2 class="card-title">Emergency Information</h2>
            <div class="emergency-actions">
                <button class="btn btn-secondary edit-emergency-btn">
                    <span class="material-icons-round">edit</span>
                    Edit Emergency Info
                </button>
                <button class="btn btn-primary save-emergency-btn hidden">
                    <span class="material-icons-round">save</span>
                    Save Changes
                </button>
                <button class="btn btn-secondary cancel-emergency-btn hidden">
                    <span class="material-icons-round">close</span>
                    Cancel
                </button>
            </div>
        </div>

        <div class="emergency-info">
            <div class="info-section">
                <h3 class="section-title">Emergency Contacts</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <h4 class="info-label">Primary Contact Name</h4>
                        <p class="info-value" id="primary-contact">{{ user.profile.emergency_contact|default:"Not Provided" }}</p>
                        <input type="text" class="info-input hidden" id="primary-contact-input"
                            value="{{ user.profile.emergency_contact|default:'' }}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Primary Contact Phone</h4>
                        <p class="info-value" id="primary-contact-phone">{% if user.profile.emergency_phone %}{{ user.profile.emergency_phone }}{% elif user.profile.phone %}{{ user.profile.phone }}{% else %}Not Provided{% endif %}</p>
                        <input type="tel" class="info-input hidden" id="primary-contact-phone-input"
                            value="{% if user.profile.emergency_phone %}{{ user.profile.emergency_phone }}{% elif user.profile.phone %}{{ user.profile.phone }}{% else %}''{% endif %}">
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Blood Type</h4>
                        <p class="info-value" id="blood-type">{{ user.profile.blood_type|default:"Not Provided" }}</p>
                        <select class="info-input hidden" id="blood-type-input">
                            <option value="">Select Blood Type</option>
                            <option value="A+" {% if user.profile.blood_type == "A+" %}selected{% endif %}>A+</option>
                            <option value="A-" {% if user.profile.blood_type == "A-" %}selected{% endif %}>A-</option>
                            <option value="B+" {% if user.profile.blood_type == "B+" %}selected{% endif %}>B+</option>
                            <option value="B-" {% if user.profile.blood_type == "B-" %}selected{% endif %}>B-</option>
                            <option value="AB+" {% if user.profile.blood_type == "AB+" %}selected{% endif %}>AB+</option>
                            <option value="AB-" {% if user.profile.blood_type == "AB-" %}selected{% endif %}>AB-</option>
                            <option value="O+" {% if user.profile.blood_type == "O+" %}selected{% endif %}>O+</option>
                            <option value="O-" {% if user.profile.blood_type == "O-" %}selected{% endif %}>O-</option>
                        </select>
                    </div>
                    <div class="info-item">
                        <h4 class="info-label">Allergies</h4>
                        <p class="info-value" id="allergies">{{ user.profile.allergies|default:"None" }}</p>
                        <input type="text" class="info-input hidden" id="allergies-input"
                            value="{{ user.profile.allergies|default:"" }}">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Settings -->
    <div class="glass-card content-card">
        <div class="card-header-row">
            <h2 class="card-title">Account Settings</h2>
        </div>

        <div class="settings-sections">
            <div class="settings-section">
                <h3 class="section-title">Security Settings</h3>
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4 class="setting-title">Change Password</h4>
                            <p class="setting-description">Update your account password</p>
                        </div>
                        <a href="{% url 'aid_app:forgot_password' %}" class="btn btn-secondary setting-btn">
                            <span class="material-icons-round">lock</span>
                            Change Password
                        </a>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4 class="setting-title">Two-Factor Authentication</h4>
                            <p class="setting-description">Add an extra layer of security</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="twoFactor" class="toggle-input">
                            <label for="twoFactor" class="toggle-label"></label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4 class="setting-title" style="color: #dc3545;">Delete Account</h4>
                            <p class="setting-description">Permanently remove your account</p>
                        </div>
                        <button class="btn-secondary" style="color: #dc3545; border-color: #dc3545;"
                            onclick="showDeleteModal()">
                            <span class="material-icons-round">delete_forever</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div id="delete-account-modal" class="modal-overlay hidden">
    <div class="glass-card modal-box">
        <h3 class="modal-title" style="color: #dc3545;">Delete Account</h3>
        <p class="modal-text" style="color: #333; margin: 20px 0;">Do you want to delete account?</p>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="hideDeleteModal()">No</button>
            <form action="{% url 'aid_app:delete_account' %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn-primary"
                    style="background-color: #dc3545; border-color: #dc3545;">Yes</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/user/user_profile.js' %}"></script>
<script>
    function showDeleteModal() {
        document.getElementById('delete-account-modal').classList.remove('hidden');
    }

    function hideDeleteModal() {
        document.getElementById('delete-account-modal').classList.add('hidden');
    }
</script>
{% endblock %}