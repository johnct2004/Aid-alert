{% extends 'responder/base_responder.html' %}
{% load static %}

{% block page_title %}Available Incidents{% endblock %}
{% block content_title %}Available Incidents{% endblock %}

{% block responder_css %}
<link rel="stylesheet" href="{% static 'css/responder/available_incidents.css' %}">
{% endblock %}

{% block responder_content %}
<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon available-icon">
            <span class="material-icons-round">list_alt</span>
        </div>
        <div>
            <h3 class="stat-label">Available Incidents</h3>
            <p class="stat-value">12</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon high-priority-icon">
            <span class="material-icons-round">priority_high</span>
        </div>
        <div>
            <h3 class="stat-label">High Priority</h3>
            <p class="stat-value">3</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon nearby-icon">
            <span class="material-icons-round">location_on</span>
        </div>
        <div>
            <h3 class="stat-label">Within 5km</h3>
            <p class="stat-value">7</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon medical-icon">
            <span class="material-icons-round">medical_services</span>
        </div>
        <div>
            <h3 class="stat-label">Medical</h3>
            <p class="stat-value">5</p>
        </div>
    </div>
</div>

<!-- Available Incidents Table Section -->
<section class="glass-card content-card">
    <div class="card-header-row">
        <h2 class="card-title">Available Incidents</h2>
        <div class="filters-wrapper">
            <div class="search-box">
                <span class="material-icons-round search-icon">search</span>
                <input type="text" class="search-input" placeholder="Search incidents...">
            </div>
            <div class="dropdowns">
                <select class="filter-select" id="urgency-filter">
                    <option value="">All Urgency</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                <select class="filter-select" id="type-filter">
                    <option value="">All Types</option>
                    <option value="medical">Medical</option>
                    <option value="fire">Fire</option>
                    <option value="accident">Accident</option>
                    <option value="police">Police</option>
                </select>
                <select class="filter-select" id="distance-filter">
                    <option value="">All Distances</option>
                    <option value="1">Within 1km</option>
                    <option value="5">Within 5km</option>
                    <option value="10">Within 10km</option>
                </select>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Location</th>
                    <th>Urgency</th>
                    <th>Time Reported</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for incident in incidents %}
                <tr>
                    <td>{{ incident.incident_id }}</td>
                    <td><span class="incident-type {{ incident.incident_type }}">{{ incident.get_incident_type_display }}</span></td>
                    <td>{{ incident.location }}</td>
                    <td>
                        <span
                            class="badge {% if incident.severity == 'critical' or incident.severity == 'high' %}badge-inactive{% else %}badge-active{% endif %}">
                            {{ incident.get_severity_display }}
                        </span>
                    </td>
                    <td>{{ incident.created_at|timesince }} ago</td>
                    <td>
                        <button class="btn-action" onclick="acceptIncident('{{ incident.incident_id }}')">
                            Accept
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align:center; padding: 20px;">No available incidents at the moment.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="pagination">
        <button class="pagination-btn" disabled>
            <span class="material-icons-round" style="font-size: 18px; margin-right: 4px;">chevron_left</span>
            Previous
        </button>
        <span class="page-info">Showing 1-12 of 45 incidents</span>
        <button class="pagination-btn">
            Next
            <span class="material-icons-round" style="font-size: 18px; margin-left: 4px;">chevron_right</span>
        </button>
    </div>
</section>
{% endblock %}

{% block responder_js %}
<script src="{% static 'js/responder/available_incidents.js' %}"></script>
{% endblock %}