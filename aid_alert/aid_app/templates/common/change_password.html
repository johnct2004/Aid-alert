{% extends 'common/base.html' %}
{% load static %}

{% block title %}Change Password - Aid Alert{% endblock %}

{% block extra_css %}
<style>
    /* Password Requirements */
    .password-requirements {
        margin-top: 10px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 8px;
        border-left: 3px solid var(--primary-color);
        text-align: left;
    }

    .requirements-title {
        font-size: 0.85rem;
        color: var(--primary-color);
        margin: 0 0 8px 0;
        font-weight: 600;
    }

    .requirements-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .requirements-list li {
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 4px;
        padding-left: 14px;
        position: relative;
        transition: color 0.3s;
    }

    .requirements-list li:before {
        content: "â€¢";
        position: absolute;
        left: 0;
        color: var(--primary-color);
    }
</style>
{% endblock %}

{% block content %}
<div class="center-container">
    <div class="glass-card auth-card">
        <a href="{% url 'aid_app:home' %}" class="logo-text">AID ALERT</a>
        <h2>Change Password</h2>

        <!-- Display Django messages -->
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <form method="POST" action="{% url 'aid_app:change_password' %}">
            {% csrf_token %}
            <div class="input-group">
                <label for="new-password">New Password</label>
                <input type="password" id="new-password" name="new_password" class="glass-input"
                    placeholder="New Password" required>
                <div class="password-requirements">
                    <p class="requirements-title">Password must contain:</p>
                    <ul class="requirements-list">
                        <li>At least 8 characters</li>
                        <li>At least one uppercase letter</li>
                        <li>At least one lowercase letter</li>
                        <li>At least one number</li>
                    </ul>
                </div>
            </div>
            <div class="input-group">
                <label for="confirm-password">Confirm Password</label>
                <input type="password" id="confirm-password" name="confirm_password" class="glass-input"
                    placeholder="Confirm Password" required>
            </div>
            <button type="submit" class="btn-submit">Confirm Change</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Password requirements validation
    const passwordInput = document.getElementById('new-password');
    const requirementsList = document.querySelector('.requirements-list');

    if (passwordInput && requirementsList) {
        const requirements = [
            { regex: /.{8,}/, text: 'At least 8 characters' },
            { regex: /[A-Z]/, text: 'At least one uppercase letter' },
            { regex: /[a-z]/, text: 'At least one lowercase letter' },
            { regex: /[0-9]/, text: 'At least one number' }
        ];

        passwordInput.addEventListener('input', function () {
            const password = this.value;
            const listItems = requirementsList.querySelectorAll('li');

            requirements.forEach((req, index) => {
                const listItem = listItems[index];
                if (req.regex.test(password)) {
                    listItem.style.color = '#2ecc71'; // Green color (matches theme logic)
                    listItem.style.textDecoration = 'line-through';
                } else {
                    listItem.style.color = '#666'; // Default color
                    listItem.style.textDecoration = 'none';
                }
            });
        });
    }
</script>
{% endblock %}