{% extends 'seller/base_seller.html' %}
{% load static %}

{% block page_title %}Dashboard{% endblock %}
{% block content_title %}Dashboard{% endblock %}

{% block seller_css %}
<link rel="stylesheet" href="{% static 'css/seller/seller_dashboard.css' %}">
{% endblock %}

{% block seller_content %}
<!-- Sales Overview -->
<div class="stats-grid">
    <div class="glass-card stat-card">
        <div class="stat-header">
            <div class="stat-icon revenue-icon">
                <span class="material-icons-round">attach_money</span>
            </div>
            <div class="stat-change positive">
                <!-- <span class="material-icons-round">trending_up</span> -->
                <span>Total earned</span>
            </div>
        </div>
        <h3 class="stat-label">Total Revenue</h3>
        <p class="stat-value" id="totalRevenue">${{ total_revenue|floatformat:2 }}</p>
    </div>

    <div class="glass-card stat-card">
        <div class="stat-header">
            <div class="stat-icon orders-icon">
                <span class="material-icons-round">shopping_bag</span>
            </div>
            <div class="stat-change positive">
                <!-- <span class="material-icons-round">trending_up</span> -->
                <span>All time orders</span>
            </div>
        </div>
        <h3 class="stat-label">Total Orders</h3>
        <p class="stat-value" id="totalOrders">{{ total_orders }}</p>
    </div>

    <div class="glass-card stat-card">
        <div class="stat-header">
            <div class="stat-icon products-icon">
                <span class="material-icons-round">inventory_2</span>
            </div>
            <div class="stat-change negative">
                <!-- <span class="material-icons-round">trending_down</span> -->
                <span>Currently active</span>
            </div>
        </div>
        <h3 class="stat-label">Active Products</h3>
        <p class="stat-value" id="activeProducts">{{ active_products }}</p>
    </div>

    <div class="glass-card stat-card">
        <div class="stat-header">
            <div class="stat-icon delivery-icon">
                <span class="material-icons-round">local_shipping</span>
            </div>
            <div class="stat-change positive">
                <!-- <span class="material-icons-round">trending_up</span> -->
                <span>To be delivered</span>
            </div>
        </div>
        <h3 class="stat-label">Pending Deliveries</h3>
        <p class="stat-value" id="pendingDeliveries">{{ pending_deliveries }}</p>
    </div>
</div>

<div class="dashboard-sections">
    <!-- Recent Orders -->
    <section class="glass-card content-card">
        <div class="card-header-row">
            <h2 class="card-title">Recent Orders</h2>
            <div class="order-actions">
                <a href="{% url 'aid_app:view_orders' %}" class="btn-action">
                    View All Orders
                </a>
            </div>
        </div>

        <div class="orders-list">
            {% if recent_orders %}
            <table class="table" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <thead>
                    <tr style="text-align: left; border-bottom: 1px solid rgba(0,0,0,0.1);">
                        <th style="padding: 10px;">Order ID</th>
                        <th style="padding: 10px;">Product</th>
                        <th style="padding: 10px;">Amount</th>
                        <th style="padding: 10px;">Status</th>
                        <th style="padding: 10px;">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in recent_orders %}
                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <td style="padding: 12px 10px;">#{{ order.order_id }}</td>
                        <td style="padding: 12px 10px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                {% if order.product.image %}
                                <img src="{{ order.product.image.url }}" alt=""
                                    style="width: 32px; height: 32px; object-fit: cover; border-radius: 4px;">
                                {% else %}
                                <div
                                    style="width: 32px; height: 32px; background: #eee; border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                                    <span class="material-icons-round"
                                        style="font-size: 16px; color: #888;">image</span>
                                </div>
                                {% endif %}
                                <span>{{ order.product.name|truncatechars:20 }}</span>
                            </div>
                        </td>
                        <td style="padding: 12px 10px; font-weight: 600;">${{ order.total_price }}</td>
                        <td style="padding: 12px 10px;">
                            <span class="status-badge {{ order.status }}" style="padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; 
                                      {% if order.status == 'delivered' %}background: #d4edda; color: #155724;
                                      {% elif order.status == 'shipped' %}background: #cce5ff; color: #004085;
                                      {% elif order.status == 'processing' %}background: #fff3cd; color: #856404;
                                      {% elif order.status == 'cancelled' %}background: #f8d7da; color: #721c24;
                                      {% else %}background: #e2e3e5; color: #383d41;{% endif %}">
                                {{ order.status|title }}
                            </span>
                        </td>
                        <td style="padding: 12px 10px; color: #666; font-size: 0.9rem;">{{ order.created_at|date:"M d,Y" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="no-orders-message">
                <span class="material-icons-round">shopping_cart</span>
                <p>No orders yet. Your products are ready for customers!</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Product Performance -->
    <section class="glass-card content-card">
        <div class="card-header-row">
            <h2 class="card-title">Top Performing Products</h2>
            <div class="product-actions">
                <a href="{% url 'aid_app:view_products' %}" class="btn-action">
                    Manage Products
                </a>
            </div>
        </div>

        <div class="products-grid">
            {% if top_products %}
            {% for item in top_products %}
            <div class="product-item">
                <div class="product-info">
                    <div class="product-image">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt=""
                            style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                        {% else %}
                        <span class="material-icons-round">medical_services</span>
                        {% endif %}
                    </div>
                    <div class="product-details">
                        <h4 class="product-name">{{ item.product.name }}</h4>
                        <p class="product-category">{{ item.product.category }}</p>
                    </div>
                </div>
                <div class="product-stats">
                    <p class="product-sales">{{ item.units_sold }} sold</p>
                    <p class="product-revenue">${{ item.revenue }}</p>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div style="text-align: center; padding: 20px; color: #666;">
                <p>No sales data available yet.</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Quick Actions -->
    <section class="glass-card content-card">
        <h2 class="card-title" style="margin-bottom: 20px;">Quick Actions</h2>

        <div class="quick-actions-grid">
            <a href="{% url 'aid_app:add_product' %}" class="quick-action-btn">
                <span class="material-icons-round">add_circle</span>
                <span>Add New Product</span>
            </a>
            <a href="{% url 'aid_app:manage_delivery' %}" class="quick-action-btn">
                <span class="material-icons-round">local_shipping</span>
                <span>View Deliveries</span>
            </a>
            <a href="{% url 'aid_app:seller_report' %}" class="quick-action-btn">
                <span class="material-icons-round">analytics</span>
                <span>Generate Report</span>
            </a>
            <a href="{% url 'aid_app:seller_profile' %}" class="quick-action-btn">
                <span class="material-icons-round">settings</span>
                <span>Account Settings</span>
            </a>
        </div>
    </section>
</div>
{% endblock %}